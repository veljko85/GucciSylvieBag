<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Babylon.js sample code</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans&display=swap"
      rel="stylesheet"
    />
    <!-- jquery -->
    <script src="https://code.nath.co/src/jQuery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/smoothscroll/1.4.10/SmoothScroll.min.js"></script>

    <!-- Babylon.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/ammo.js"></script>
    <script src="https://preview.babylonjs.com/cannon.js"></script>
    <script src="https://preview.babylonjs.com/Oimo.js"></script>
    <script src="https://preview.babylonjs.com/earcut.min.js"></script>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

    <style>
      body {
        overflow-x: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      /* Hide scrollbar for Chrome, Safari and Opera */
      body::-webkit-scrollbar {
        display: none;
      }

      /* Hide scrollbar for IE, Edge and Firefox */
      body {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }
    </style>
  </head>
  <body>
    <div
      class="container"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        /* background-color: rgb(0, 0, 0); */
        /* background: url('space2.png');
        background-size: cover; */
        z-index: 1;
      "
    >
      <canvas
        id="renderCanvas"
        style="
          width: 100%;
          height: 100%;
          float: left;
          touch-action: none;
          -webkit-tap-highlight-color: rgba(255, 255, 255, 0) !important;
          -webkit-focus-ring-color: rgba(255, 255, 255, 0) !important;
          outline: none !important;
          opacity: 1;
        "
      >
      </canvas>
      <div
        id="scrollDiv"
        style="
          width: 4px;
          height: 0;
          margin-top: 5px;
          border-radius: 5px;
          background-color: rgb(0, 0, 0);
          z-index: 8;
          position: absolute;
          right: 5px;
          opacity: 0.5;
        "
      ></div>
    </div>
    <div
      id="landingPageContainer"
      style="
        width: 100vw;
        height: 100vh;
        /* margin-top: -100vh; */
        position: fixed;
        /* background-color: rgb(7, 7, 7);
        background: url('beginingBackground.png');
          background-size: cover; */
        opacity: 1;
        z-index: 2;
      "
    ></div>
    <div
      style="
        width: 100vw;
        height: 24900px;
        /* margin-top: -100vh; */
        position: relative;
        z-index: 5;
      "
    ></div>
    <div
      style="
        width: 35%;
        height: 3%;
        position: fixed;
        bottom: 3%;
        left: 32.5%;
        z-index: 10;
        /* background-color: brown; */
      "
    >
      <div
        id="blackBagTag"
        style="
          width: 4.5%;
          height: 100%;
          margin-left: 25.25%;
          background: url('img/black.png');
          background-size: cover;
          background-position: center;
          float: left;
        "
      ></div>
      <div
        id="redBagTag"
        style="
          width: 4.5%;
          height: 100%;
          margin-left: 4.5%;
          background: url('img/red.png');
          background-size: cover;
          background-position: center;
          float: left;
        "
      ></div>
      <div
        id="yellowBagTag"
        style="
          width: 4.5%;
          height: 100%;
          margin-left: 4.5%;
          background: url('img/yellow.png');
          background-size: cover;
          background-position: center;
          float: left;
        "
      ></div>
      <div
        id="whiteBagTag"
        style="
          width: 4.5%;
          height: 100%;
          margin-left: 4.5%;
          background: url('img/white.png');
          background-size: cover;
          background-position: center;
          float: left;
        "
      ></div>
      <div
        id="greenBagTag"
        style="
          width: 4.5%;
          height: 100%;
          margin-left: 4.5%;
          background: url('img/green.png');
          background-size: cover;
          background-position: center;
          float: left;
        "
      ></div>
      <div
        id="brownBagTag"
        style="
          width: 4.5%;
          height: 100%;
          margin-left: 4.5%;
          background: url('img/brown.png');
          background-size: cover;
          background-position: center;
          float: left;
        "
      ></div>
    </div>

    <script>
      var landingPageContainer = document.getElementById(
        "landingPageContainer"
      );
      // window.pageYOffset = 0;

      var canvas = document.getElementById("renderCanvas");

      // renderCanvasWelcomeScroll.style.width = "0vw";
      // canvas.style.width = "100vw";
      var engine = null;
      var scene = null;
      var sceneToRender = null;
      var createDefaultEngine = function () {
        return new BABYLON.Engine(canvas, true, {
          preserveDrawingBuffer: true,
          stencil: true,
          disableWebGL2Support: false,
        });
      };
      var createScene = function () {
        var scene = new BABYLON.Scene(engine);

        // scene.clearColor = new BABYLON.Color3.FromHexString("#ffffff");

        var light = new BABYLON.HemisphericLight(
          "light",
          new BABYLON.Vector3(0, 1, -1),
          scene
        );
        light.intensity = 1;
        var light2 = new BABYLON.HemisphericLight(
          "light",
          new BABYLON.Vector3(0, 1, 1),
          scene
        );
        light2.intensity = 1;
        var light3 = new BABYLON.HemisphericLight(
          "light",
          new BABYLON.Vector3(0, -1, -1),
          scene
        );
        light3.intensity = 1;
        var light4 = new BABYLON.HemisphericLight(
          "light",
          new BABYLON.Vector3(0, -1, 1),
          scene
        );
        light4.intensity = 1;

        var camera = new BABYLON.ArcRotateCamera(
          "Camera",
          0,
          0,
          0,
          new BABYLON.Vector3(0, 0, 0),
          scene
        );
        camera.attachControl(canvas, true);
        camera.setPosition(new BABYLON.Vector3(3, 5, -8));
        scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);

        scene.environmentTexture = new BABYLON.CubeTexture(
          "https://raw.githubusercontent.com/veljko85/environments/gh-pages/environment.env",
          scene
        );

        var box = BABYLON.Mesh.CreateBox(
          "SkyBox",
          500,
          scene,
          false,
          BABYLON.Mesh.BACKSIDE
        );
        box.material = new BABYLON.SkyMaterial("sky", scene);
        box.material.inclination = -0.35;
        box.material.luminance = 0.8;
        box.material.azimuth = 0.25;
        box.material.cameraOffset.y = scene.activeCamera.globalPosition.y;
        box.position.y = 0;

        // Create a particle system

        var fogTexture = new BABYLON.Texture(
          "https://raw.githubusercontent.com/aWeirdo/Babylon.js/master/smoke_15.png",
          scene
        );

        var createNewSystem = function (
          emiter,
          particleSystemWidth,
          particleSystemHeight,
          particleSystem,
          useGPUVersion,
          gustina
        ) {
          if (particleSystem) {
            particleSystem.dispose();
          }

          if (useGPUVersion && BABYLON.GPUParticleSystem.IsSupported) {
            particleSystem = new BABYLON.GPUParticleSystem(
              "particles",
              { capacity: gustina },
              scene
            );
            particleSystem.activeParticleCount = 100;
            particleSystem.manualEmitCount = particleSystem.activeParticleCount;
            particleSystem.minEmitBox = new BABYLON.Vector3(0, 0, 0); // Starting all from
            particleSystem.maxEmitBox = new BABYLON.Vector3(
              particleSystemWidth,
              0.2,
              particleSystemHeight
            ); // To..
          } else {
            particleSystem = new BABYLON.ParticleSystem(
              "particles",
              gustina,
              scene
            );
            particleSystem.manualEmitCount = particleSystem.getCapacity();
            particleSystem.minEmitBox = new BABYLON.Vector3(0, 0, 0); // Starting all from
            particleSystem.maxEmitBox = new BABYLON.Vector3(
              particleSystemWidth,
              0.2,
              particleSystemHeight
            ); // To...
          }

          particleSystem.particleTexture = fogTexture.clone();
          particleSystem.emitter = emiter;

          particleSystem.color1 = new BABYLON.Color4(0.8, 0.8, 0.8, 0.1);
          particleSystem.color2 = new BABYLON.Color4(0.95, 0.95, 0.95, 0.15);
          particleSystem.colorDead = new BABYLON.Color4(0.9, 0.9, 0.9, 0.1);
          particleSystem.minSize = 0.1;
          particleSystem.maxSize = 0.1;
          particleSystem.minLifeTime = Number.MAX_SAFE_INTEGER;
          particleSystem.emitRate = 1000;
          particleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_STANDARD;
          particleSystem.gravity = new BABYLON.Vector3(0, 0, 0);
          particleSystem.direction1 = new BABYLON.Vector3(0, 0, 0);
          particleSystem.direction2 = new BABYLON.Vector3(0, 0, 0);
          particleSystem.minAngularSpeed = 1;
          particleSystem.maxAngularSpeed = 3;
          particleSystem.minEmitPower = 0.5;
          particleSystem.maxEmitPower = 0.5;
          particleSystem.updateSpeed = 0.005;

          particleSystem.start();
        };

        var particleSystem1;
        var useGPUVersion1 = false;

        //fountain to be emmietr for clouds-particles
        floreCloud = BABYLON.Mesh.CreateBox("floreCloud", 0.01, scene);
        floreCloud.position = new BABYLON.Vector3(-0.5, -2.48, 0.5);
        floreCloud.visibility = 0;

        createNewSystem(
          floreCloud,
          1,
          0.1,
          particleSystem1,
          useGPUVersion1,
          2000
        );

        var particleSystem2;
        var useGPUVersion2 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(1, 0, -2);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.4,
          0.1,
          particleSystem2,
          useGPUVersion2,
          100
        );

        var particleSystem3;
        var useGPUVersion3 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(-1, 0, -2);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.7,
          0.1,
          particleSystem3,
          useGPUVersion3,
          100
        );

        var particleSystem4;
        var useGPUVersion4 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(2, -0.5, -1);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.7,
          0.1,
          particleSystem4,
          useGPUVersion4,
          100
        );

        var particleSystem5;
        var useGPUVersion5 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(1, -2, -2);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.4,
          0.1,
          particleSystem5,
          useGPUVersion5,
          100
        );

        var particleSystem6;
        var useGPUVersion6 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(1, -3, -1);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.4,
          0.1,
          particleSystem6,
          useGPUVersion6,
          100
        );

        var particleSystem7;
        var useGPUVersion7 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(2, -3, 0);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.3,
          0.1,
          particleSystem7,
          useGPUVersion7,
          100
        );

        var particleSystem8;
        var useGPUVersion8 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(1, -3, 1);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.3,
          0.2,
          particleSystem8,
          useGPUVersion8,
          100
        );

        var particleSystem9;
        var useGPUVersion9 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(0, -2, -2);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.4,
          0.1,
          particleSystem9,
          useGPUVersion9,
          100
        );

        var particleSystem10;
        var useGPUVersion10 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(-1, -2.5, -1);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.4,
          0.1,
          particleSystem10,
          useGPUVersion10,
          100
        );

        var particleSystem11;
        var useGPUVersion11 = false;

        cloudOne = BABYLON.Mesh.CreateBox("cloudOne", 0.01, scene);
        cloudOne.position = new BABYLON.Vector3(-2, -3, 1);
        cloudOne.visibility = 0;

        createNewSystem(
          cloudOne,
          0.4,
          0.1,
          particleSystem11,
          useGPUVersion11,
          100
        );

        let blackBagTag = document.getElementById("blackBagTag");
        blackBagTag.onclick = () => {
          console.log("radi");
        };

        BABYLON.SceneLoader.ImportMesh(
          "",
          "",
          "meshes/torba.glb",
          scene,
          function (newMeshes) {
            var torba = newMeshes[0];
            scene.activeCamera = scene.cameras[1];
            // scene.activeCamera.attachControl(canvas, false);

            scene.animationGroups.find((a) => a.name === "CameraAction").play();
            scene.animationGroups
              .find((a) => a.name === "CameraAction")
              .pause();

            var landingPageContainer = document.getElementById(
              "landingPageContainer"
            );
            var frame = 0;
            let oldValue = 0;
            let newValue = 0;

            window.addEventListener("scroll", () => {
              const currentScroll = window.pageYOffset;
              newValue = window.pageYOffset;
              scene.beforeRender = function () {
                if (oldValue < newValue) {
                  frame = currentScroll * 0.001;
                  torba.position.y = -(currentScroll * 0.0001);
                } else if (oldValue > newValue) {
                  frame = currentScroll * 0.001;
                  torba.position.y = -(currentScroll * 0.0001);
                }
                oldValue = newValue;
                scene.animationGroups
                  .find((a) => a.name === "CameraAction")
                  .play(true);
                scene.animationGroups
                  .find((a) => a.name === "CameraAction")
                  .goToFrame(frame);
                scene.animationGroups
                  .find((a) => a.name === "CameraAction")
                  .pause();
              };
            });

            scene.getMaterialByID("telo").albedoColor =
              BABYLON.Color3.FromHexString("#000000");
            scene.getMaterialByID("masne").albedoColor =
              BABYLON.Color3.FromHexString("#000000");
            scene.getMaterialByID("sav").albedoColor =
              BABYLON.Color3.FromHexString("#000000");

            let blackBagTag = document.getElementById("blackBagTag");
            blackBagTag.onclick = () => {
              scene.getMaterialByID("telo").albedoColor =
                BABYLON.Color3.FromHexString("#000000");
              scene.getMaterialByID("masne").albedoColor =
                BABYLON.Color3.FromHexString("#000000");
            };

            let redBagTag = document.getElementById("redBagTag");
            redBagTag.onclick = () => {
              scene.getMaterialByID("telo").albedoColor =
                BABYLON.Color3.FromHexString("#ff0000");
              scene.getMaterialByID("masne").albedoColor =
                BABYLON.Color3.FromHexString("#ff0000");
            };

            let yellowBagTag = document.getElementById("yellowBagTag");
            yellowBagTag.onclick = () => {
              scene.getMaterialByID("telo").albedoColor =
                BABYLON.Color3.FromHexString("#ffff00");
              scene.getMaterialByID("masne").albedoColor =
                BABYLON.Color3.FromHexString("#ffff00");
            };

            let whiteBagTag = document.getElementById("whiteBagTag");
            whiteBagTag.onclick = () => {
              scene.getMaterialByID("telo").albedoColor =
                BABYLON.Color3.FromHexString("#ffffff");
              scene.getMaterialByID("masne").albedoColor =
                BABYLON.Color3.FromHexString("#ffffff");
            };

            let greenBagTag = document.getElementById("greenBagTag");
            greenBagTag.onclick = () => {
              scene.getMaterialByID("telo").albedoColor =
                BABYLON.Color3.FromHexString("#116A1D");
              scene.getMaterialByID("masne").albedoColor =
                BABYLON.Color3.FromHexString("#116A1D");
            };

            let brownBagTag = document.getElementById("brownBagTag");
            brownBagTag.onclick = () => {
              scene.getMaterialByID("telo").albedoColor =
                BABYLON.Color3.FromHexString("#8B4513");
              scene.getMaterialByID("masne").albedoColor =
                BABYLON.Color3.FromHexString("#271203");
            };

            //green 116A1D
            //brown 8B4513
          }
        );
        var scollDiv = document.getElementById("scrollDiv");
        let max = document.body.scrollHeight - innerHeight;
        document.addEventListener("scroll", function () {
          // console.log((pageYOffset / max) * 1);
          scollDiv.style.height = (pageYOffset / max) * 99 + "%";
        });

        return scene;
      };

      window.initFunction = async function () {
        var asyncEngineCreation = async function () {
          try {
            return createDefaultEngine();
          } catch (e) {
            console.log(
              "the available createEngine function failed. Creating the default engine instead"
            );
            return createDefaultEngine();
          }
        };

        window.engine = await asyncEngineCreation();
        if (!engine) throw "engine should not be null.";
        window.scene = createScene();
      };
      initFunction().then(() => {
        sceneToRender = scene;
        engine.runRenderLoop(function () {
          if (sceneToRender && sceneToRender.activeCamera) {
            sceneToRender.render();
          }
        });
      });

      // Resize
      window.addEventListener("resize", function () {
        engine.resize();
      });
    </script>
    <!-- jquery for smooth scroll -->
    <script>
      SmoothScroll({
        // Scrolling Core
        animationTime: 2000, // [ms]
        stepSize: 100, // [px]

        // Acceleration
        accelerationDelta: 50, // 50
        accelerationMax: 3, // 3

        // Keyboard Settings
        keyboardSupport: true, // option
        arrowScroll: 50, // [px]

        // Pulse (less tweakable)
        // ratio of "tail" to "acceleration"
        pulseAlgorithm: true,
        pulseScale: 4,
        pulseNormalize: 1,

        // Other
        touchpadSupport: false, // ignore touchpad by default
        fixedBackground: true,
        excluded: "",
      });
    </script>
  </body>
</html>
